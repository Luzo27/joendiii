<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cliente - Joen' Di</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:#f5efe6;color:#5c3d2e;overflow-x:hidden;}
.navbar{width:100%;background:#f5efe6;padding:10px 20px;display:flex;justify-content:flex-start;align-items:center;gap:15px;position:sticky;top:0;z-index:100;box-shadow:0 2px 6px rgba(0,0,0,0.05);}
.menu-btn{display:flex;flex-direction:column;justify-content:space-between;width:28px;height:20px;cursor:pointer;}
.menu-btn span{display:block;height:4px;background:#d9b382;border-radius:2px;transition:0.3s;}
.category-menu{position:absolute;top:50px;left:20px;background:white;padding:12px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.08);display:none;flex-direction:column;gap:8px;}
.category-menu button{padding:8px;border:0;border-radius:8px;background:#d9b382;color:white;font-weight:600;cursor:pointer;transition:0.3s;}
.category-menu button:hover{background:#c39d6d;transform:scale(1.03);}
.hero{width:100%;height:280px;background:url('img/verduras1.jpg') center/cover no-repeat;display:flex;justify-content:center;align-items:center;text-align:center;color:white;font-size:32px;font-weight:700;text-shadow:2px 2px 12px rgba(0,0,0,0.6);border-bottom-left-radius:24px;border-bottom-right-radius:24px;margin-bottom:20px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px;padding:0 20px 40px 20px;}
.card{background:white;padding:16px;border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,0.08);display:flex;flex-direction:column;gap:10px;text-align:center;transition:0.3s;position:relative;overflow:hidden;}
.card img{width:100%;height:150px;object-fit:cover;border-radius:12px;border:2px solid #d9b382;transition:transform 0.3s;}
.card:hover img{transform:scale(1.05);}
.card h4{font-size:18px;font-weight:600;color:#5c3d2e;}
.card p{font-size:14px;color:#7a5a45;}
.card button{padding:8px 12px;border:0;border-radius:10px;background:#d9b382;color:white;font-weight:600;cursor:pointer;transition:0.3s;}
.card button:hover{background:#c39d6d;transform:scale(1.05);}
.cart-fab{position:fixed;right:28px;bottom:28px;background:#5c3d2e;color:white;padding:16px 22px;border-radius:999px;cursor:pointer;font-weight:700;box-shadow:0 10px 25px rgba(0,0,0,0.2);transition:0.3s;z-index:100;}
.cart-fab:hover{transform:scale(1.1);background:#4e3225;}
.cart-panel{position:fixed;right:20px;bottom:90px;width:320px;background:white;border-radius:14px;padding:14px;display:none;box-shadow:0 12px 40px rgba(0,0,0,0.18);z-index:99;}
.cart-panel h3{margin-bottom:10px;color:#5c3d2e;}
.cart-panel div{display:flex;justify-content:space-between;margin-bottom:6px;}
.cart-panel button{margin-top:10px;padding:10px;width:100%;border:0;border-radius:10px;background:#d9b382;color:white;font-weight:600;cursor:pointer;}
.cart-panel button:hover{background:#c39d6d;transform:scale(1.03);}
h2{text-align:center;padding-bottom:12px;font-size:28px;color:#5c3d2e;}
</style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RC78WB2HHE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RC78WB2HHE');
</script>
</head>
<body>

<!-- Navbar -->
<div class="navbar">
  <div class="menu-btn" id="menuBtn">
    <span></span>
    <span></span>
    <span></span>
  </div>
  <div style="font-weight:700;font-size:20px;">Joen' Di - Cliente</div>
</div>

<!-- Men√∫ categor√≠as desplegable -->
<div class="category-menu" id="categoryMenu">
  <button data-cat="todos">Todos</button>
</div>

<!-- Hero -->
<div class="hero">
  ¬°Bienvenidüçé a Joen' Di!<br>
</div>

<h2>Productos Disponibles</h2>
<div class="grid" id="grid"></div>

<div class="cart-fab" id="fab">üõí <span id="cart-count">0</span></div>

<aside class="cart-panel" id="cartPanel">
  <h3>Tu compra üòä</h3>
  <div id="cartList"></div>
  <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
    <strong>Total:</strong>
    <strong id="cartTotal">$0.00</strong>
  </div>
  <button id="checkout">Pagar</button>
</aside>

<script>
let productos = [];
let cart = {};

const grid = document.getElementById('grid');
const fab = document.getElementById('fab');
const panel = document.getElementById('cartPanel');
const cartCount = document.getElementById('cart-count');
const cartList = document.getElementById('cartList');
const cartTotal = document.getElementById('cartTotal');
const categoryMenu = document.getElementById('categoryMenu');
const menuBtn = document.getElementById('menuBtn');

// Traer productos desde Node.js / MySQL
fetch('http://localhost:3000/productos')
  .then(res => res.json())
  .then(data => {
    productos = data.map(p => ({
      id: p.id,
      nombre: p.nombre,
      precio: parseFloat(p.precio),
      img: p.imagen,
      cat: 'General'
    }));
    renderProductos();
    generarCategorias();
  })
  .catch(err => console.error(err));

function renderProductos(filtro='todos'){
  grid.innerHTML = '';
  productos.filter(p => filtro==='todos' || p.cat===filtro).forEach(p=>{
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML=`
      <img src="${p.img}" alt="${p.nombre}">
      <h4>${p.nombre}</h4>
      <p>${p.cat}</p>
      <p>$${p.precio.toFixed(2)}</p>
      <button data-id="${p.id}">Comprar</button>
    `;
    grid.appendChild(card);
  });
}

function generarCategorias(){
  const cats = [...new Set(productos.map(p=>p.cat))];
  categoryMenu.innerHTML = '<button data-cat="todos">Todos</button>';
  cats.forEach(c=>{
    const btn = document.createElement('button');
    btn.textContent = c;
    btn.dataset.cat = c;
    categoryMenu.appendChild(btn);
  });
}

// Toggle men√∫ categor√≠as
menuBtn.addEventListener('click', ()=> categoryMenu.style.display = categoryMenu.style.display==='flex'?'none':'flex');

// Filtrar por categor√≠a
categoryMenu.addEventListener('click', e=>{
  const cat = e.target.dataset.cat;
  if(cat) renderProductos(cat);
});

// Carrito
grid.addEventListener('click', e=>{
  const id = e.target.dataset.id;
  if(!id) return;
  const p = productos.find(x=>x.id==id);
  cart[id] = cart[id] || {...p, qty:0};
  cart[id].qty++;
  updateCartUI();
});

fab.addEventListener('click', ()=> panel.style.display = panel.style.display==='block'?'none':'block');

function updateCartUI(){
  const count = Object.values(cart).reduce((s,i)=>s+i.qty,0);
  cartCount.textContent = count;
  cartList.innerHTML = '';
  let total = 0;
  Object.values(cart).forEach(item=>{
    total += item.precio * item.qty;
    const div = document.createElement('div');
    div.textContent = `${item.nombre} x ${item.qty}`;
    const price = document.createElement('span');
    price.textContent = `$${(item.precio*item.qty).toFixed(2)}`;
    div.appendChild(price);
    cartList.appendChild(div);
  });
  cartTotal.textContent = `$${total.toFixed(2)}`;
}

document.getElementById('checkout').addEventListener('click', ()=>{
  if(Object.keys(cart).length===0){ alert('El carrito est√° vac√≠o'); return; }
  alert(`Gracias por tu compra. Total: ${cartTotal.textContent}`);
  cart={};
  updateCartUI();
});
</script>
</body>
</html>
